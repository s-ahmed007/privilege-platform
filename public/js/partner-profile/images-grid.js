!function(i){function t(t){this.opts=t||{},this.$window=i(window),this.$element=this.opts.element,this.$gridItems=[],this.modal=null,this.imageLoadCount=0;var e=this.opts.cells;this.opts.cells=1>e?1:e>6?6:e,this.onWindowResize=this.onWindowResize.bind(this),this.onImageClick=this.onImageClick.bind(this),this.init()}function e(t){this.opts=t||{},this.imageIndex=null,this.$document=i(document),this.$modal=null,this.$indicator=null,this.close=this.close.bind(this),this.prev=this.prev.bind(this),this.next=this.next.bind(this),this.onIndicatorClick=this.onIndicatorClick.bind(this),this.onImageLoaded=this.onImageLoaded.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.$document.on("keyup",this.onKeyUp)}i.fn.imagesGrid=function(e){var o=arguments;return this.each(function(){if(i.isPlainObject(e)){this._imgGrid instanceof t&&(this._imgGrid.destroy(),delete this._imgGrid);var n=i.extend({},i.fn.imagesGrid.defaults,e);return n.element=i(this),void(this._imgGrid=new t(n))}if("string"==typeof e&&this._imgGrid instanceof t)switch(e){case"modal.open":this._imgGrid.modal.open(o[1]);break;case"modal.close":this._imgGrid.modal.close();break;case"destroy":this._imgGrid.destroy(),delete this._imgGrid}})},i.fn.imagesGrid.defaults={images:[],cells:5,align:!1,nextOnClick:!0,showViewAll:"more",viewAllStartIndex:"auto",loading:"Loading...",getViewAllText:function(i){return"View all "+i+" images"},onGridRendered:i.noop,onGridItemRendered:i.noop,onGridLoaded:i.noop,onGridImageLoaded:i.noop,onModalOpen:i.noop,onModalClose:i.noop,onModalImageClick:i.noop,onModalImageUpdate:i.noop},t.prototype.init=function(){this.setGridClass(),this.renderGridItems(),this.createModal(),this.$window.on("resize",this.onWindowResize)},t.prototype.createModal=function(){var i=this.opts;this.modal=new e({loading:i.loading,images:i.images,nextOnClick:i.nextOnClick,onModalOpen:i.onModalOpen,onModalClose:i.onModalClose,onModalImageClick:i.onModalImageClick,onModalImageUpdate:i.onModalImageUpdate})},t.prototype.setGridClass=function(){var i=this.opts,t=i.images.length,e=t<i.cells?t:i.cells;this.$element.addClass("imgs-grid imgs-grid-"+e)},t.prototype.renderGridItems=function(){var i=this.opts,t=i.images,e=t.length;if(t){this.$element.empty(),this.$gridItems=[];for(var o=0;e>o&&o!==i.cells;++o)this.renderGridItem(t[o],o);("always"===i.showViewAll||"more"===i.showViewAll&&e>i.cells)&&this.renderViewAll(),i.onGridRendered(this.$element)}},t.prototype.renderGridItem=function(t,e){var o=t,n="",s="",a=this.opts,d=this;i.isPlainObject(t)&&(o=t.thumbnail||t.src,n=t.alt||"",s=t.title||"");var l=i("<div>",{"class":"imgs-grid-image",click:this.onImageClick,data:{index:e}});l.append(i("<div>",{"class":"image-wrap"}).append(i("<img>",{src:o,alt:n,title:s,on:{load:function(e){d.onImageLoaded(e,i(this),t)}}}))),this.$gridItems.push(l),this.$element.append(l),a.onGridItemRendered(l,t)},t.prototype.renderViewAll=function(){var t=this.opts;this.$element.find(".imgs-grid-image:last .image-wrap").append(i("<div>",{"class":"view-all"}).append(i("<span>",{"class":"view-all-cover"}),i("<span>",{"class":"view-all-text",text:t.getViewAllText(t.images.length)})))},t.prototype.onWindowResize=function(i){this.opts.align&&this.align()},t.prototype.onImageClick=function(t){var e,o=this.opts,n=i(t.currentTarget);e=n.find(".view-all").length>0&&"number"==typeof o.viewAllStartIndex?o.viewAllStartIndex:n.data("index"),this.modal.open(e)},t.prototype.onImageLoaded=function(i,t,e){var o=this.opts;++this.imageLoadCount,o.onGridImageLoaded(i,t,e),this.imageLoadCount===this.$gridItems.length&&(this.imageLoadCount=0,this.onAllImagesLoaded())},t.prototype.onAllImagesLoaded=function(){var i=this.opts;i.align&&this.align(),i.onGridLoaded(this.$element)},t.prototype.align=function(){var i=this.$gridItems.length;switch(i){case 2:case 3:this.alignItems(this.$gridItems);break;case 4:this.alignItems(this.$gridItems.slice(0,2)),this.alignItems(this.$gridItems.slice(2));break;case 5:case 6:this.alignItems(this.$gridItems.slice(0,3)),this.alignItems(this.$gridItems.slice(3))}},t.prototype.alignItems=function(t){var e=t.map(function(i){return i.find("img").height()}),o=Math.min.apply(null,e);i(t).each(function(){var t=i(this),e=t.find(".image-wrap"),n=t.find("img"),s=n.height();if(e.height(o),s>o){var a=Math.floor((s-o)/2);n.css({top:-a})}})},t.prototype.destroy=function(){this.$window.off("resize",this.onWindowResize),this.$element.empty().removeClass("imgs-grid imgs-grid-"+this.$gridItems.length),this.modal.destroy()},e.prototype.open=function(i){this.isOpened()||(this.imageIndex=parseInt(i)||0,this.render())},e.prototype.close=function(i){if(this.$modal){var t=this.opts;this.$modal.animate({opacity:0},{duration:100,complete:function(){this.$modal.remove(),this.$modal=null,this.$indicator=null,this.imageIndex=null,t.onModalClose()}.bind(this)})}},e.prototype.isOpened=function(){return this.$modal&&this.$modal.is(":visible")},e.prototype.render=function(){var i=this.opts;this.renderModal(),this.renderCaption(),this.renderCloseButton(),this.renderInnerContainer(),this.renderIndicatorContainer(),this.$modal.animate({opacity:1},{duration:100,complete:function(){i.onModalOpen(this.$modal,i.images[this.imageIndex])}.bind(this)})},e.prototype.renderModal=function(){this.$modal=i("<div>",{"class":"imgs-grid-modal"}).appendTo("body")},e.prototype.renderCaption=function(){this.$caption=i("<div>",{"class":"modal-caption",text:this.getImageCaption(this.imageIndex)}).appendTo(this.$modal)},e.prototype.renderCloseButton=function(){this.$modal.append(i("<div>",{"class":"modal-close",click:this.close}))},e.prototype.renderInnerContainer=function(){var t=this.opts,e=this.getImage(this.imageIndex);this.$modal.append(i("<div>",{"class":"modal-inner"}).append(i("<div>",{"class":"modal-image"}).append(i("<img>",{src:e.src,alt:e.alt,title:e.title,on:{load:this.onImageLoaded,click:function(t){this.onImageClick(t,i(this),e)}.bind(this)}}),i("<div>",{"class":"modal-loader",html:t.loading})),i("<div>",{"class":"modal-control left",click:this.prev}).append(i("<div>",{"class":"arrow left"})),i("<div>",{"class":"modal-control right",click:this.next}).append(i("<div>",{"class":"arrow right"})))),t.images.length<=1&&this.$modal.find(".modal-control").hide()},e.prototype.renderIndicatorContainer=function(){var t=this.opts,e=t.images.length;if(1!=e){this.$indicator=i("<div>",{"class":"modal-indicator"});var o,n=i("<ul>");for(o=0;e>o;++o)n.append(i("<li>",{"class":this.imageIndex==o?"selected":"",click:this.onIndicatorClick,data:{index:o}}));this.$indicator.append(n),this.$modal.append(this.$indicator)}},e.prototype.prev=function(){var i=this.opts.images.length;this.imageIndex>0?--this.imageIndex:this.imageIndex=i-1,this.updateImage()},e.prototype.next=function(){var i=this.opts.images.length;this.imageIndex<i-1?++this.imageIndex:this.imageIndex=0,this.updateImage()},e.prototype.updateImage=function(){var i=this.opts,t=this.getImage(this.imageIndex),e=this.$modal.find(".modal-image img");if(e.attr({src:t.src,alt:t.alt,title:t.title}),this.$modal.find(".modal-caption").text(this.getImageCaption(this.imageIndex)),this.$indicator){var o=this.$indicator.find("ul");o.children().removeClass("selected"),o.children().eq(this.imageIndex).addClass("selected")}this.showLoader(),i.onModalImageUpdate(e,t)},e.prototype.onImageClick=function(i,t,e){var o=this.opts;o.nextOnClick&&this.next(),o.onModalImageClick(i,t,e)},e.prototype.onImageLoaded=function(){this.hideLoader()},e.prototype.onIndicatorClick=function(t){var e=i(t.target).data("index");this.imageIndex=e,this.updateImage()},e.prototype.onKeyUp=function(i){if(this.$modal)switch(i.keyCode){case 27:this.close();break;case 37:this.prev();break;case 39:this.next()}},e.prototype.getImage=function(t){var e=this.opts,o=e.images[t];return i.isPlainObject(o)?o:{src:o,alt:"",title:""}},e.prototype.getImageCaption=function(i){var t=this.getImage(i);return t.caption||""},e.prototype.showLoader=function(){this.$modal&&(this.$modal.find(".modal-image img").hide(),this.$modal.find(".modal-loader").show())},e.prototype.hideLoader=function(){this.$modal&&(this.$modal.find(".modal-image img").show(),this.$modal.find(".modal-loader").hide())},e.prototype.destroy=function(){this.$document.off("keyup",this.onKeyUp),this.close()}}(jQuery);